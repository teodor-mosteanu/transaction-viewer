<div class="transaction-wrapper">
  <form
    class="date-filters"
    [formGroup]="filterFormGroup"
    (ngSubmit)="filterTransactions()"
  >
    <span>Search dates: </span>
    <label for="dateFilter" class="screenreader-text">Date created</label>
    <p-calendar
      ariaLabel="Select start date filter"
      inputId="dateFilter"
      formControlName="startDate"
      dateFormat="yy.mm.dd"
      [showIcon]="true"
      [maxDate]="filterFormGroup.get('endDate')?.value || today"
    ></p-calendar>
    <span>TO</span>
    <label for="dateFilter" class="screenreader-text">Date created</label>
    <p-calendar
      ariaLabel="Select end date filter"
      inputId="dateFilter"
      formControlName="endDate"
      dateFormat="yy.mm.dd"
      [showIcon]="true"
      [minDate]="filterFormGroup.get('startDate')?.value || startDay"
    ></p-calendar>
    <p-dropdown
      ariaLabel="Select a status filter"
      formControlName="selectedStatus"
      [options]="paymentStatuses"
      placeholder="Select a Status"
      [showClear]="true"
    >
      <ng-template let-status pTemplate="item">
        <div class="flex align-items-center gap-2">
          <div>{{ status }}</div>
        </div>
      </ng-template></p-dropdown
    >
    <p-button label="Submit" type="submit"></p-button>
  </form>
  <!-- /* TODO: total transactions not updating on api call [TM 22/03/24] */ -->
  <!-- TODO: break up the template  [TM 23/03/24] -->
  <p-table
    ariaLabel="Select a status option to filter"
    [value]="paymentTransactions"
    [lazy]="true"
    (onLazyLoad)="changePage($event)"
    dataKey="id"
    [tableStyle]="{ 'min-width': '75rem' }"
    [paginator]="true"
    [rows]="5"
    [totalRecords]="transactions?.totalNumberOfItems || 0"
    [showCurrentPageReport]="true"
    [loading]="loading"
  >
    <ng-template pTemplate="header">
      <tr>
        <th pSortableColumn="amount">
          Amount <p-sortIcon field="amount"></p-sortIcon>
        </th>
        <th pSortableColumn="createdAt">
          Created At <p-sortIcon field="createdAt"></p-sortIcon>
        </th>
        <th pSortableColumn="currency">
          Currency <p-sortIcon field="currency"></p-sortIcon>
        </th>
        <th pSortableColumn="description">
          Description <p-sortIcon field="description"></p-sortIcon>
        </th>
        <th pSortableColumn="id">ID <p-sortIcon field="id"></p-sortIcon></th>
        <th pSortableColumn="status">
          Status <p-sortIcon field="status"></p-sortIcon>
        </th>
      </tr>
    </ng-template>
    <ng-template pTemplate="body" let-transaction>
      <tr>
        <td>{{ transaction.amount }}</td>
        <td>{{ transaction.createdAt | date: 'yyyy-MM-dd' }}</td>
        <td>{{ transaction.currency }}</td>
        <td>{{ transaction.description }}</td>
        <td>{{ transaction.id }}</td>
        <td>{{ transaction.status }}</td>
      </tr>
    </ng-template>
  </p-table>
</div>
